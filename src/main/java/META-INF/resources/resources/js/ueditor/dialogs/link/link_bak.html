<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<script type="text/javascript" src="../internal.js"></script>
<style type="text/css">
* {
	margin: 0;
	padding: 0;
	color: #838383;
}

table {
	font-size: 12px;
	margin: 10px;
	line-height: 30px
}

.txt {
	width: 300px;
	height: 21px;
	line-height: 21px;
	border: 1px solid #d7d7d7;
}
</style>
</head>
<body>
	<input class="txt" id="href" type="hidden" value="viewPage.do?n=" />
	<table>
		<tr>
			<td><label for="title">名称：</label></td>
			<td><input class="txt" id="title" type="text" disabled="true" /></td>
		</tr>
		<tr>
			<td><label for="text">词条：</label></td>
			<td><input class="txt" id="text" type="text" disabled="true" /></td>
		</tr>
		<!--  <tr>
             <td colspan="2">
                 <label for="target"><var id="lang_input_target"></var></label>
                 <input id="target" type="checkbox"/>
             </td>
        </tr> -->
		<tr>
			<td colspan="2" id="msg"></td>
		</tr>
	</table>
	<script type="text/javascript">
    var range = editor.selection.getRange(),
        link = range.collapsed ? editor.queryCommandValue( "link" ) : editor.selection.getStart(),
        url,
        text = $G('text'),
        title = $G('title'),
        rangeLink = domUtils.findParentByTagName(range.getCommonAncestor(),'a',true),
        orgText, orgTitle;
        
    link = domUtils.findParentByTagName( link, "a", true );
    
    if(link){
        url = utils.html(link.getAttribute( '_href' ) || link.getAttribute( 'href', 2 ));
        if(rangeLink === link && !link.getElementsByTagName('img').length){
            text.removeAttribute('disabled');
            title.removeAttribute('disabled');
            orgTitle = title.value = link.text;
            orgText = text.value = url.substring(url.indexOf('n=') + 2);
        }else{
            text.setAttribute('disabled','true');
            title.setAttribute('disabled', 'true');
            text.value = '';
            title.value = '';
        }

    }else{
        if(range.collapsed){
            text.removeAttribute('disabled');
            text.value = '';
            title.removeAttribute('disabled');
            title.value = '';
        }else{
            text.setAttribute('disabled','true');
            text.value = '';
            title.setAttribute('disabled','true');
            title.value = '';
        }

    }
    
    $G("href").value = url ? url : '';
   
    function handleDialogOk(){
    	if(title.value == '' || text.value == ''){
    		$G('msg').innerHTML = '<span style="color:red">名称和应用不能为空</span>';
    		return false;
    	}
    	$G('href').value = 'viewPage.do?n=' + $G('text').value;
        var href = $G('href').value.replace(/^\s+|\s+$/g, '');
        if(href){
            var obj = {
                'href' : href,
                'class' : 'lnkKnows'
            };
            //修改链接内容的情况太特殊了，所以先做到这里了
            //todo:情况多的时候，做到command里
            if(orgTitle && orgText ){
                link[browser.ie ? 'innerText' : 'textContent'] =  obj.textValue = title.value;
                range.selectNode(link).select();
            }
            if(range.collapsed){
                obj.textValue = title.value;
            }
            editor.execCommand('link', utils.clearEmptyAttrs(obj) );
            dialog.close();
        }
    }
    
    dialog.onok = handleDialogOk;

    function hrefStartWith(href,arr){
        href = href.replace(/^\s+|\s+$/g, '');
        for(var i=0,ai;ai=arr[i++];){
            if(href.indexOf(ai)==0){
                return true;
            }
        }
        return false;
    }
</script>
</body>
</html>
