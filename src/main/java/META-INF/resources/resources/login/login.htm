<!DOCTYPE HTML>
<html lang="en">
<head>
<title>欢迎使用TechSure BSM</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<meta http-equiv="Vary" content="*" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/png" href="/balantflow/resources/images/tsfavicon.png" />
<link rel="stylesheet" href="/balantflow/resources/login/css/login.css" />
<script type="text/javascript" src="/balantflow/resources/js/jquery/jquery-1.11.1.js"></script>
<script type="text/javascript" src="/balantflow/resources/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/balantflow/resources/login/js/psw.js"></script>
<!--[if lt IE 10]> 
<script type="text/javascript">
 	window.location.href = '/balantflow/resources/login/iealert.htm';
</script>
<![endif]-->
<script type="text/javascript">
	$(function() {
		$("#loginContainer").hide().fadeIn('slow');
		//for the client time zone
		var offset = new Date().getTimezoneOffset();
		var f = '';
		if (offset <= 0) {
			f = '+';
		} else {
			f = '-';
		}
		offset = Math.abs(offset);
		var h = parseInt(offset / 60);
		var m = offset - h * 60;
		var t = f + h + ":" + (m >= 10 ? m : "0" + m);
		$.cookie('BSM_TIMEZONE', t);
		//init language
 		if ($.cookie('locale') == 'en_US') {
			$('#sltLang').addClass('icon-language-en').removeClass('icon-language-ch');
			$('#sltLang').attr('title','English');
		} else {
			$('#sltLang').removeClass('icon-language-en').addClass('icon-language-ch');
			$('#sltLang').attr('title','中文');
		}
		//init theme
 		if ($.cookie('theme') == 'theme_white') {
			$('#sltTheme').removeClass('icon-theme-black').addClass('icon-theme-white');
			$('#sltTheme').attr('title','浅色主题');
			$('body').removeClass('theme-black').addClass('theme-white');
		} else {
			$('#sltTheme').addClass('icon-theme-black').removeClass('icon-theme-white');
			$('#sltTheme').attr('title','深色主题');
			$('body').addClass('theme-black').removeClass('theme-white');
		}	
		
		//reload iframe 
		if (self != top) {
			top.location.reload();
		}
		//for lower browser
		$('#closeTips').click(function() {
			$('#browserTips').slideUp('slow');
		});
		//ensure the input isn't empty
		$("#txtUserPassword").focus(function() {
			$(this).next().hide();
		}).blur(function(){
			if($(this).val()==""){
				$(this).next().html('请输入密码').show();
			}else{
				$(this).next().empty().hide();
			}			
		});
		$("#txtUserName").focus(function() {
			$(this).next().hide();
		}).blur(function(){
			if($.trim($(this).val())==""){
				$(this).next().html('请输入用户名').show();
			}else{
				$(this).next().empty().hide();
			}
		});
		//loginbtn
		$('#btnLogin').click(function() {
			valid();
			if (valid()) {
				var psw = $('#txtUserPassword').val();
				$("#txtUserName").val($.trim($("#txtUserName").val().toUpperCase()));
				//$('#loginForm').submit();
				$(this).attr('disabled', 'disabled');
				$(this).html('login...');
				var logindata={};
				logindata={
					'j_username':$("#txtUserName").val(),
					'j_password':'{ENCRYPED}'+$.md5(psw)
				}
				$.ajax({
					type : "POST",
					url : "/balantflow/j_security_check",
					data : logindata,
					success : function(data, status, xhr) {
						if ($.trim(data) == 'LOGIN_FAILED') {
							$('#spnError').show();
						} else {
							$('#spnError').hide();
							window.location.reload();
						}
						$('#btnLogin').removeAttr('disabled');
						$('#btnLogin').html('login');
					}
				});
			}
		});
		//key-enter action
		$(document).on('keydown', function(e) {
			if (e.keyCode == 13) {
				$('#btnLogin').click();
				e.preventDefault();
			}
		});		
		//change language
		$('#sltLang').click(function() {
			if($(this).hasClass('icon-language-ch')){
				$(this).addClass('icon-language-en').removeClass('icon-language-ch');
				$(this).attr('title','English');
				$.cookie('locale', 'en_US', {
					expires : 365,
					path : '/'
				});
			}else{
				$(this).removeClass('icon-language-en').addClass('icon-language-ch');
				$(this).attr('title','中文');
				$.cookie('locale', 'zh_CN', {
					expires : 365,
					path : '/'
				});
			}
		});
		//change theme
		$('#sltTheme').click(function() {
			if($(this).hasClass('icon-theme-white')){
				$(this).addClass('icon-theme-black').removeClass('icon-theme-white');
				$(this).attr('title','深色主题');
				$('body').addClass('theme-black').removeClass('theme-white');
				initMaterial('black');
				$.cookie('theme', 'theme_black', {
					expires : 365,
					path : '/'
				});
			}else{
				$(this).removeClass('icon-theme-black').addClass('icon-theme-white');
				$(this).attr('title','浅色主题');
				$('body').removeClass('theme-black').addClass('theme-white');
				initMaterial('white');
				$.cookie('theme', 'theme_white', {
					expires : 365,
					path : '/'
				});
			}
		});
	});
	function valid(){
		var isPass = true;
		if($("#txtUserPassword").val()==""){
			$("#txtUserPassword").next().html('请输入密码').show();
			isPass = false;
		}else{
			$("#txtUserPassword").next().empty().hide();
		}
		if($.trim($("#txtUserName").val())==""){
			$("#txtUserName").next().html('请输入用户名').show();
			isPass = false;
		}else{
			$("#txtUserName").next().empty().hide();
		}
		return isPass;
	}
</script>
</head>
<body>
	<!--[if lt IE 10]> 
	<div id="browserTips">
		温馨提示：您使用的浏览器版本过低，建议升级到IE10及以上版本获得更好的体验。 <a href="http://ie.microsoft.com/" target="_blank" class="btn">立即升级</a>
		<span id="closeTips" title="忽略提示">X</span>
	</div>
	<![endif]-->	
	<div id="canvasDiv"></div>
		<div id="moreContainer">
			<div class="more-select icon-language-ch" id="sltLang"></div>
			<div class="more-select icon-theme-white" id="sltTheme"></div>
		</div>
		<div id="loginContainer">
			<form method="GET" id="loginForm" name="loginForm">
				<h2>TechSure<span class="title-bottom">For your better IT service</span></h2>
				<div class="clearfix">
					<div class="form-block">
						<i class="form-icon icon-user"></i>
						<input class="form-control" type="text" id="txtUserName" name="j_username" placeholder="Username" value="">
						<div class="error-tips"></div>
					</div>
					<div class="form-block">
						<i class="form-icon icon-password"></i>
						<input class="form-control" type="password" id="txtUserPassword" name="j_password" placeholder="Password" value="">
						<div class="error-tips"></div>
					</div>
					<div class="form-block">
					<button type="button" id="btnLogin">login</button>
					<div><span class="error-tips" id="spnError">用户名或密码错误</span></div>
					</div>					
				</div>
				
			</form>
		</div>		
	<script type="text/javascript" src="/balantflow/resources/login/js/three.min.js"></script>
	<script type="text/javascript" src="/balantflow/resources/login/js/Projector.js"></script>
	<script type="text/javascript" src="/balantflow/resources/login/js/CanvasRenderer.js"></script>
	<script>
	var AMOUNTX = 35, AMOUNTY = 40;
	var camera, scene, renderer;
	var particles, particle, count = 0;
	init();
	animate();
	window.onresize=function(){
		onWindowResize();
	};
	function init() {
		camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, window.innerHeight*10);
		camera.position.z = 0;
        camera.position.x = window.innerWidth;
        camera.position.y =window.innerHeight/3;
 		if ($.cookie('theme') == 'theme_white') {
 			initMaterial('white');
		} else {
			initMaterial('black');
		}
        renderer = new THREE.CanvasRenderer({'alpha':true});
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight);
        $('#canvasDiv').append(renderer.domElement);
    }

    function onWindowResize() {
    	camera.aspect = window.innerWidth / window.innerHeight;
    	camera.updateProjectionMatrix();
    	renderer.setSize( window.innerWidth, window.innerHeight);
    }

    function animate() {
    	requestAnimationFrame( animate );
    	render();
    }

    function render() {
    	camera.lookAt( scene.position );
    	var i = 0;
    	for ( var ix = 0; ix < AMOUNTX; ix ++ ) {
    		for ( var iy = 0; iy < AMOUNTY; iy ++ ) {
    			particle = particles[ i++ ];
    			var py = ( Math.sin( ( ix + count ) * 0.3 ) * 40 ) + ( Math.sin( ( iy + count ) * 0.5 ) * 40 );
    			particle.position.y = py;
    			particle.scale.x = particle.scale.y = ( Math.sin( ( ix + count ) * 0.3 ) + 1.2 ) * 4 + ( Math.sin( ( iy + count ) * 0.3 ) + 1.2 ) * 4;
			}
		}
		renderer.render( scene, camera);
		count += 0.005;
	}
	function initMaterial(type){
		var SEPARATION = 130;
        scene = new THREE.Scene();
        scene.background = null;
        particles = new Array();
        var type = type || 'white';
        var material;
        if(type == 'black'){
        	material = new THREE.SpriteCanvasMaterial( {
            	program: function ( context ) {
            		context.beginPath();
    				var radial = context.createRadialGradient(0, 0, 0, 0,0, 0.8);
    				radial.addColorStop(0,"rgba(255, 255, 255, 0.8)");
    				radial.addColorStop(1,"rgba(255, 255, 255, 0.1)");
    				context.fillStyle = radial;
    				context.arc( 0, 0,0.8, 0, Math.PI * 2, true );
    				context.fill();
    			}
    		});
        }else{
        	material = new THREE.SpriteCanvasMaterial( {
            	program: function ( context ) {
            		context.beginPath();
					var radial = context.createRadialGradient(0, 0, 0, 0,0, 1);
					radial.addColorStop(0,"rgba(173, 229, 241, 1)");
					radial.addColorStop(1,"rgba(173, 229, 241, 0)");
					context.fillStyle = radial;
					context.arc( 0, 0,1, 0, Math.PI * 2, true );
					context.fill();
    			}
    		});
        }
        var i = 0;
        for ( var ix = 0; ix < AMOUNTX; ix ++ ) {
        	for ( var iy = 0; iy < AMOUNTY; iy ++ ) {
        		particle = particles[ i ++ ] = new THREE.Sprite( material );
        		particle.position.x = ix * SEPARATION - ( ( AMOUNTX * SEPARATION ) / 2 );
        		particle.position.z = iy * SEPARATION - ( ( AMOUNTY * SEPARATION ) / 2 );
        		scene.add( particle );
        	}
        }		
	}
	</script>
</body>
</html>
